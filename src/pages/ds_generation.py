import streamlit as st
import numpy as np
import pandas as pd
from common_functions import load_scor_model, save_scor_model
from generation import dataset_generation
import os


st.set_page_config(layout="wide")
st.title("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞")
st.markdown(
    """
    –î–∞—Ç–∞—Å–µ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –Ω–∏–∂–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –∏ –∏—Ö –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏.
    –í –ø–æ–ª–µ :red[weight] —É–∫–∞–∑–∞–Ω—ã –≤–µ—Å–∞ (–∑–Ω–∞—á–∏–º–æ—Å—Ç—å) –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è. 
    –í—ã –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–∏–º–æ—Å—Ç—å –ª—é–±–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è, –æ–±–ª–∞–¥–∞—è —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ –≤ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.
    –£–∫–∞–∑–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∏ –∏—Ö –∑–Ω–∞—á–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞. 
    """
)

# –∑–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∫–æ—Ä–º–æ–¥–µ–ª—å –∏–∑ —Ñ–∞–π–ª–∞ (–∫—Ä–∏—Ç–µ—Ä–∏–∏, –≤–µ—Å–∞, –º–∏–Ω, –º–∞–∫—Å –∏ —Ç–ø)
df = load_scor_model()
if not df.empty:
    # –í—ã–≤–æ–¥ —Ç–∞–±–ª–∏—Ü—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    edited_df = st.data_editor(
        df,
        width=1400,
        height=455,
        column_order=["name", "weight", "description"],
        disabled=["name", "description"],
    )

    # –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª
    if st.button("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"):
        save_scor_model(edited_df)
        st.success("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")

    # –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞
    if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç"):
        # –≤—ã–≤–æ–¥ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞. –£–î–ê–õ–ò–¢–¨ –ü–û–°–õ–ï –û–¢–õ–ê–î–ö–ò
        df_synt = dataset_generation(edited_df, 10)
        st.success("–î–∞—Ç–∞—Å–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω. –ú–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –µ–≥–æ")

        os.makedirs("data", exist_ok=True)
        excel_file = "data/synthetic_dataset.xlsx"
        df_synt.to_excel(excel_file, index=False)

        # –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞
        with open(excel_file, "rb") as f:
            st.download_button(
                label="–°–∫–∞—á–∞—Ç—å Excel —Ñ–∞–π–ª",
                data=f,
                file_name=excel_file,
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            )

        st.dataframe(df_synt)
else:
    st.error("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–π–ª—ã —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞", icon="üö®")
